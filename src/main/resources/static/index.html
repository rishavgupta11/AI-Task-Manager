<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AI Task Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
            color: #111;
            transition: background 0.2s, color 0.2s;
        }
        body.dark {
            background: #111827;
            color: #e5e7eb;
        }

        h1, h2 {
            margin-bottom: 10px;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .task {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            background: white;
            position: relative;
        }
        body.dark .task {
            background: #1f2937;
            border-color: #374151;
        }

        /* Thin left bar for priority */
        .task::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-radius: 6px 0 0 6px;
        }
        .high::before   { background: #ef4444; }
        .medium::before { background: #f59e0b; }
        .low::before    { background: #10b981; }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0 10px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            box-sizing: border-box;
        }
        body.dark input,
        body.dark textarea {
            background: #111827;
            color: #e5e7eb;
            border-color: #374151;
        }

        button {
            padding: 8px 16px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #1d4ed8;
        }
        .delete-btn {
            background: #dc2626;
        }
        .delete-btn:hover {
            background: #b91c1c;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-right: 6px;
        }
        .badge-priority-high   { background: #ef4444; }
        .badge-priority-medium { background: #f59e0b; }
        .badge-priority-low    { background: #10b981; }

        .badge-category-work     { background: #3b82f6; }
        .badge-category-personal { background: #8b5cf6; }
        .badge-category-health   { background: #22c55e; }
        .badge-category-finance  { background: #0ea5e9; }
        .badge-category-shopping { background: #f97316; }
        .badge-category-urgent   { background: #dc2626; }
        .badge-category-unknown  { background: #6b7280; }

        .meta {
            margin-top: 8px;
            margin-bottom: 6px;
        }

        .dark-toggle {
            font-size: 13px;
            cursor: pointer;
            border-radius: 20px;
            padding: 4px 10px;
            border: 1px solid #9ca3af;
            background: transparent;
            color: inherit;
        }
        .dark-toggle:hover {
            background: rgba(148, 163, 184, 0.2);
        }
    </style>
</head>
<body>
<div class="toolbar">
    <h1>AI-Powered Task Manager</h1>
    <button class="dark-toggle" onclick="toggleDarkMode()">üåó Theme</button>
</div>

<div>
    <h2>Create New Task</h2>
    <input type="text" id="title" placeholder="Task Title">
    <textarea id="description" placeholder="Task Description" rows="3"></textarea>
    <button onclick="createTask()">Create Task</button>
</div>

<div>
    <h2>Your Tasks</h2>
    <div id="taskList"></div>
</div>

<script>
    const API_URL = 'http://localhost:8080/api/tasks';

    // --- Dark mode ---
    function applyTheme(theme) {
        if (theme === 'dark') document.body.classList.add('dark');
        else document.body.classList.remove('dark');
    }
    function toggleDarkMode() {
        const current = localStorage.getItem('theme') === 'dark' ? 'dark' : 'light';
        const next = current === 'dark' ? 'light' : 'dark';
        localStorage.setItem('theme', next);
        applyTheme(next);
    }
    applyTheme(localStorage.getItem('theme') || 'light');

    // --- API calls ---
    async function createTask() {
        const title = document.getElementById('title').value.trim();
        const description = document.getElementById('description').value.trim();
        if (!title || !description) return;

        const res = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, description })
        });

        if (res.ok) {
            document.getElementById('title').value = '';
            document.getElementById('description').value = '';
            loadTasks();
        }
    }

    async function loadTasks() {
        const res = await fetch(API_URL);
        const tasks = await res.json();

        const taskList = document.getElementById('taskList');
        taskList.innerHTML = tasks.map(task => renderTask(task)).join('');
    }

    async function deleteTask(id) {
        await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        loadTasks();
    }

    function renderTask(task) {
        const priority = task.aiPriority || 'UNKNOWN';
        const category = task.aiCategory || 'UNKNOWN';

        const priorityClass = priority.toLowerCase(); // high/medium/low
        const priorityBadgeClass = 'badge-priority-' + priority.toLowerCase();

        const categoryKey = category.toLowerCase(); // work/health/...
        const categoryBadgeClass = 'badge-category-' +
            (['work','personal','health','finance','shopping','urgent'].includes(categoryKey)
                ? categoryKey
                : 'unknown');

        const categoryIcon = {
            work: 'üíº',
            personal: 'üè†',
            health: 'ü©∫',
            finance: 'üí∞',
            shopping: 'üõí',
            urgent: 'üî•'
        }[categoryKey] || '‚ùî';

        const priorityIcon = {
            high: 'üö®',
            medium: '‚ö†Ô∏è',
            low: '‚úÖ',
            unknown: '‚ùî'
        }[priority.toLowerCase()] || '‚ùî';

        return `
            <div class="task ${priorityClass}">
                <h3>${task.title}</h3>
                <p>${task.description}</p>
                <div class="meta">
                    <span class="badge ${priorityBadgeClass}">
                        ${priorityIcon} ${priority}
                    </span>
                    <span class="badge ${categoryBadgeClass}">
                        ${categoryIcon} ${category}
                    </span>
                </div>
                <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
            </div>
        `;
    }

    // initial load
    loadTasks();
</script>
</body>
</html>
